"use strict";let limit=20,offset=0,total=0,currentPage=0;const pageIdPatt=/page\-(\d+)/,ajaxUrl="music-fc-ajax.php";let testElem,eventDateStr,eventTimeStr,eventTitle;function addClickListeners(){$("#next-btn").on("click",(function(t){t.preventDefault(),$(".page-btn.active").is(":last-child")||getEvents(offset+limit,limit,currentPage+1)})),$("#prev-btn").on("click",(function(t){t.preventDefault(),$(".page-btn.active").is(":first-child")||getEvents(offset-limit,limit,currentPage-1)})),$(".page-btn").on("click",(function(t){t.preventDefault();let e=parseInt(pageIdPatt.exec($(this).attr("id"))[1]);getEvents(limit*(e-1),limit,e)})),$(".edit-btn").on("click",(function(t){t.preventDefault(),$("#modal-action-type").data("action","edit"),$("#new-event-modal-label").html("Edit Event"),$(this).parent().parent().siblings().each((function(t,e){/\d{2}\/\d{2}\/\d{2}/.test($(e).html())?eventDateStr=$(e).html():"TBA"==$(e).html()?eventTimeStr="12:00 am":/\d{1,2}:\d{2}\s[ap]m/.test($(e).html())?eventTimeStr=$(e).html():eventTitle=$(e).html()}));let e=new Date(`${eventDateStr} ${eventTimeStr}`);eventDateStr=formatDate(e),eventTimeStr=formatTime(e),$("#new-event-date").val(eventDateStr),$("#new-event-time").val(eventTimeStr),$("#new-event-title").val(eventTitle),$("#edit-event-id").val($(this).parent().siblings("input").data("id"))})),$(".delete-btn").on("click",(function(t){t.preventDefault();let e=parseInt($(this).parent().siblings('input[type="hidden"]').data("id")),n=$(this).parents("td").siblings('td[colspan="3"]').html();total--,deleteEvent(e,n)})),$("#add-btn").on("click",(function(t){t.preventDefault(),$("#modal-action-type").data("action","add"),$("#new-event-modal-label").html("Add New Event")})),$("#form-add-new-event").on("submit",(function(t){t.preventDefault(),t.stopImmediatePropagation();const e=$("#form-add-new-event").serializeArray();let n={};e.forEach(t=>{n[t.name]=t.value}),"add"==$("#modal-action-type").data("action")?(total++,addEvent(n)):"edit"==$("#modal-action-type").data("action")&&eventUpdate(n),$("#new-event-modal").modal("hide")})),$("#new-event-modal").on("hidden.bs.modal",(function(t){$("#form-add-new-event .form-group div input").each((function(){$(this).val("")}))}))}function getEvents(t,e,n){doAjax({action:"get-event",offset:t,limit:e}).then(a=>updateHTML(a,t,e,n))}function updateHTML(t,e,n,a){$(window).scrollTop(120),$("#events-table tbody").html(t),$(".page-btn").removeClass("active"),$("#page-"+a).addClass("active"),offset=e,currentPage=a,$("#start-idx").html(e+1),$("#end-idx").html(e+n<total?e+n:total),$("#event-count").html(total),addClickListeners()}function setInitialData(){offset=parseInt($("#start-idx").html())-1,limit=parseInt($("#limit").val()),total=parseInt($("#event-count").html()),currentPage=parseInt(pageIdPatt.exec($("#page-buttons .page-btn.active").attr("id"))[1])}async function deleteEvent(t,e){doAjax({action:"delete-event",target:t,title:e}).then(t=>{switch(parseInt(t)){case 1:getEvents(offset,limit,currentPage);break;case 0:alert("There was an error deleting the events.");break;case-1:alert("Target ID not set.");break;default:console.log(t)}})}function addEvent(t){t.action="create-event",doAjax(t).then(t=>{switch(parseInt(t)){case 1:getEvents(offset,limit,currentPage);break;case 0:alert("There was an error adding the event.")}})}function eventUpdate(t){t.action="edit-event",t["old-date"]=eventDateStr,t["old-time"]=eventTimeStr,t["old-title"]=eventTitle,doAjax(t).then(t=>{switch(parseInt(t)){case 1:getEvents(offset,limit,currentPage);break;case 0:alert("There was a problem updating the event.")}})}async function doAjax(t){let e="";try{e=await $.ajax({url:ajaxUrl,method:"post",data:t})}catch(t){console.error(t)}return e}function formatDate(t){console.log(t.getMonth());let e=t.getFullYear()+"-";return e+=t.getMonth()+1<10?"0"+t.getMonth():t.getMonth()+1,e+="-",e+=t.getDate()<10?"0"+t.getDate():t.getDate()}function formatTime(t){let e=t.getHours()<10?"0"+t.getHours():t.getHours();return e+=":",e+=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()}$(document).ready((function(){setInitialData(),addClickListeners()}));